## Splunk DB 연동
1. 추가 앱 찾기 -> Splunk DB Connect -> tar 파일 업로드 -> 다시시작
2. JRE 설정 -> 재시작
3.  `C:\Splunk\etc\apps\splunk_app_db_connect\drivers`에 `mysql-connector-java-8.0.27.jar `넣기
4.  `설정` ->` Databases` -> `Identities` 추가
5.  `Connection` 도 추가    
`jdbc:mysql://192.168.56.101:3306/snort?useSSL=false` SSL 사용 안하기 
6.  `Data Lab` -> `Inputs` -> `connection` 설정     
    ```sql
    -- 이걸로 excute 테스트
    select a.cid, a.timestamp, b.sig_name, inet_ntoa(c.ip_src), inet_ntoa(c.ip_dst), unhex(d.data_payload)
    from event a, signature b, iphdr c, data d
    where a.signature = b.sig_id
    and a.sid = c.sid and a.cid = c.cid
    and a.sid = d.sid and a.cid = d.cid
    ```
    `Batch 옵션` -> 전체 연동, 계속해서 같은데이터를 가져와서 중복이 됨 -> `Rising 옵션` 으로 선택  
    `choose Column` -> `timestamp` 선택
7.  Rising 옵션 추가 설정: `Rising Column` -> `cid` 필드 선택   
    `cid` 필드로 중복이 아닌지를 체크하는 것임
8.  `checkpoint value` 0으로 설정 후 아래 쿼리문 실행
    ``` sql
    -- ? 은 최초로는 0 그 다음에는 이전 설정 값으로 됨
    select a.cid, a.timestamp, b.sig_name, inet_ntoa(c.ip_src), inet_ntoa(c.ip_dst), unhex(d.data_payload)
    from event a, signature b, iphdr c, data d
    where a.signature = b.sig_id
    and a.sid = c.sid and a.cid = c.cid
    and a.sid = d.sid and a.cid = d.cid
    and a.cid > ?
    order by a.cid asc
    ```
9.  `execution frequency` `10`  
`*****` -> 1분마다, 매 시간마다, 매일, 매월, 매요일     
`10` -> 10초 간격으로 
10. `source type` ->  `snortdb`
11. `인덱스` -> `snortdb`
12. `검색` -> `index=snortdb`
13. `datalab` -> `입력 편집` -> `sql alias 추가`, `data_payload 함수 해제`
    ```sql
    select a.cid, a.timestamp, b.sig_name, inet_ntoa(c.ip_src) as ip_src, inet_ntoa(c.ip_dst) as ip_dst, d.data_payload
    from event a, signature b, iphdr c, data d
    where a.signature = b.sig_id
    and a.sid = c.sid and a.cid = c.cid
    and a.sid = d.sid and a.cid = d.cid
    and a.cid > ?
    order by a.cid asc
    ```
14. rule 추가
15. msg.map 파일 설정
16. wget www.google.com 실행 하면
17. db에 로그 저장되고 `index=snortdb`로 확인 가능
18. 페이로드값 파싱하기     
`index=snortdb | eval data_payload=replace(data_payload, "(..)", "%\1") | eval data_payload=urldecode(data_payload)` 